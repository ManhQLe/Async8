var Async8={Queue:function(a,b,d,c){function e(b){g<a.length?a[g++](e,b):d?d(b):1}var g=0;c?setImmediate(e,b):e(b)},PQueue:function(a,b,d){var c=[],e=0;a.forEach(function(a,f){c.push(null);setImmediate(a,function(a){c[f]=a;++e==c.length?d?d(c):1:0},b,f)})},DPQueue:function(a,b,d,c){c=c?c:a.length;for(var e=[],g=0;g<c;g++)e.push(b);this.PQueue(e,a,d)},MA:function(a){return new Async8._.MA(a)},N0:function(a,b,d,c){this.Name=a;this.fx=b;this.Props=d;this.Async=c;this.InputCount=0;this.Params={};this.Collected=
0;this.Link2=[];this.Board=null},_:{MA:function(a){this.Nodes=[];var b=this;a.forEach(function(a,c){for(var e=0;e<a.length;e+=2){var g=b.GetNode(a[e]),f=e+1;if(f<a.length){var l=a[f],f=b.GetNode(a[f+1]);f.InputCount++;g.Link2.push({Local:l,Node:f})}}});this.Leaves=this.Leafed=0;this.LastParams={};this.Nodes.forEach(function(a){a.Link2.length?1:b.Leaves++})}}};Async8.N0.prototype.Fire=function(a,b){this.Async?setImmediate(this.fx,this,a,b,this.Board):this.fx(a,b,this.Board)};
Async8._.MA.prototype.GetNode=function(a){var b={};switch(typeof a){case "object":b=a;break;case "function":b.Name=a.name||Async8._.MA.Config.GetName();b.fx=a;break;default:b.Name=a}var d,c=this.Nodes.every(function(a,c){d=c;return a.Name!==b.Name});if(c&&!b.fx)throw"Undeclared node name: "+a;c?(b=Async8._.MA.DESC(b.Name,b.fx,b.Props,b.Async),b.Board=this,this.Nodes.push(b)):b=this.Nodes[d];return b};
Async8._.MA.prototype.ExecNode=function(a,b,d){function c(b,c){var d=Async8._.MA.FX.GetFlows(c),k,h;a.Link2.forEach(function(a){h=a.Node;k=d(h,c);0<k&&(++h.Collected,k--,a.Local?h.Params[a.Local]=b:h.Params=b);e.ExecNode(h,h.Params,k)});a.Link2.length?1:(e.LastParams[a.Name]=b,++e.Leafed==e.Leaves?(e.Leafed=0,e.Endfx?e.Endfx(e.LastParams):0):1)}var e=this;(d?d:0)+a.Collected>=a.InputCount&&(a.Collected=0,a.Fire(c,b))};
Async8._.MA.prototype.Fire=function(a,b,d,c){this.Global=c;this.LastParams={};d?this.Endfx=d:1;var e=this;this.Nodes.forEach(function(c){if(b&&0<=b.indexOf(c.Name)||0==c.InputCount){var d=a.hasOwnProperty(c.Name)?a[c.Name]:{};c.Params=d;e.ExecNode(c,c.Params,c.InputCount)}})};Async8._.MA.Config={i:0,GetName:function(){return"Annonymous"+this.i++}};
Async8._.MA.Flows={Default:function(a,b){return 1},ChooseCurrent:function(a,b){return b.hasOwnProperty(a.Name)?b[a.Name]:0},FireBoost:function(a,b){return 0<=b.indexOf(a.Name)?a.InputCount:1}};Async8._.MA.FX={GetFlows:function(a){return a?Array.isArray(a)?Async8._.MA.Flows.FireBoost:a.call?a:Async8._.MA.Flows.ChooseCurrent:Async8._.MA.Flows.Default}};Async8._.MA.DESC=function(a,b,d,c){return new Async8.N0(a,b,d,c)};Async8.DESC=Async8._.MA.DESC;
