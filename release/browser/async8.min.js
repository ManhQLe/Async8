var Async8={Queue:function(a,b,c,e,d){function g(b,d){d?c(null,d):f<a.length?a[f++](g,b,e):c(b,null,e)}var f=0;c?1:c=function(){};d?setTimeout(g,0,b):g(b)},PQueue:function(a,b,c,e){c?1:c=function(){};var d=[],g=0,f=!1;a.length?a.forEach(function(a,k){d.push(null);setTimeout(a,0,function(a,b){d[k]=a;b&&!f?(f=!0,c(d,b,k,e)):++g==d.length?c(d,null,-1,e):1},b,k,e)}):c(d,e)},DPQueue:function(a,b,c,e,d){d=d?d:a.length;for(var g=[],f=0;f<d;f++)g.push(b);this.PQueue(g,a,c,e)},MA:function(a){return new Async8._.MA(a)},
N0:function(a,b,c,e){this.Name=a;this.fx=b;this.Props=c;this.Async=e;this.InputCount=0;this.Params={};this.Collected=0;this.Link2=[];this.Board=null},_:{MA:function(a){this.Nodes=[];var b=this;a.forEach(function(a,e){for(var d=0;d<a.length;d+=2){var g=b.GetNode(a[d]),f=d+1;if(f<a.length){var m=a[f],f=b.GetNode(a[f+1]);f.InputCount++;g.Link2.push({Local:m,Node:f})}}});this.Leaves=this.Leafed=0;this.LastParams={};this.Nodes.forEach(function(a){a.Link2.length?1:b.Leaves++})}}};
Async8.N0.prototype.Fire=function(a,b){this.Async?setImmediate(this.fx,this,a,b,this.Board):this.fx(a,b,this.Board)};
Async8._.MA.prototype.GetNode=function(a){var b={};switch(typeof a){case "object":b=a;break;case "function":b.Name=a.name||Async8._.MA.Config.GetName();b.fx=a;break;default:b.Name=a}var c,e=this.Nodes.every(function(a,g){c=g;return a.Name!==b.Name});if(e&&!b.fx)throw"Undeclared node name: "+a;e?(b=Async8._.MA.DESC(b.Name,b.fx,b.Props,b.Async),b.Board=this,this.Nodes.push(b)):b=this.Nodes[c];return b};
Async8._.MA.prototype.ExecNode=function(a,b,c){function e(b,c,e){if(c)d.Error=c,d.Endfx(null,c);else{var k=MA.FX.GetFlows(e),l,h;a.Link2.forEach(function(a){h=a.Node;l=k(h,e);0<l&&(++h.Collected,l--,a.Local?h.Params[a.Local]=b:h.Params=b);d.ExecNode(h,h.Params,l)});a.Link2.length?1:(d.LastParams[a.Name]=b,++d.Leafed==d.Leaves?(d.Leafed=0,d.Endfx(d.LastParams)):1)}}var d=this;!d.Error&&(c?c:0)+a.Collected>=a.InputCount&&(a.Collected=0,a.Fire(e,b))};
Async8._.MA.prototype.Fire=function(a,b,c,e){this.Global=e;this.LastParams={};c?this.Endfx=c:1;var d=this;this.Nodes.forEach(function(c){if(b&&0<=b.indexOf(c.Name)||0==c.InputCount){var e=a.hasOwnProperty(c.Name)?a[c.Name]:{};c.Params=e;d.ExecNode(c,c.Params,c.InputCount)}})};Async8._.MA.Config={i:0,GetName:function(){return"Annonymous"+this.i++}};
Async8._.MA.Flows={Default:function(a,b){return 1},ChooseCurrent:function(a,b){return b.hasOwnProperty(a.Name)?b[a.Name]:0},FireBoost:function(a,b){return 0<=b.indexOf(a.Name)?a.InputCount:1}};Async8._.MA.FX={GetFlows:function(a){return a?Array.isArray(a)?Async8._.MA.Flows.FireBoost:a.call?a:Async8._.MA.Flows.ChooseCurrent:Async8._.MA.Flows.Default}};Async8._.MA.DESC=function(a,b,c,e){return new Async8.N0(a,b,c,e)};Async8.DESC=Async8._.MA.DESC;
